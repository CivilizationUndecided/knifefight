@using Sandbox;
@using Sandbox.UI;
@using Sandbox.Network;

@implements INavigatorPage
@namespace Facepunch.UI

<root class="hc1 layout padding-insane">
    <div class="page header">
        <img class="logo" src="/ui/teams/operators_logo_banner.png" />

        <div class="divider" />

        <label class="title">SERVER BROWSER</label>
    </div>

    <div class="flex grow">
        <ServerBrowser CurrentLobby:bind=@Lobby  @ref="Browser" />
    </div>

    <div class="page footer">
        <div class="layout row gap flex-grow">
            <a class="button standard" href="/">back</a>
            <div style="flex-grow: 1;"/>
            <div class="button standard" onclick=@(() => Create())>Create a server</div>
            <div class="button standard" onclick=@(() => Refresh())>refresh</div>
            <div class="button standard @(Lobby.HasValue ? "" : "no-anim disabled")" onclick=@(() => Join())>Connect</div>
        </div>
    </div>
</root>

@code
{
    public ServerBrowser Browser { get; set; }

    public Lobby? Lobby { get; set; }

    private void Refresh()
    {
        Browser.Refresh();
    }

    private void Create()
    {
        this.Navigate( "/new" );
    }

    private async void Join()
    {
        if ( !Lobby.HasValue ) return;

        var lobby = Lobby.Value;
        if ( lobby.IsFull ) return;

        if ( await GameNetworkSystem.TryConnectSteamId( lobby.LobbyId ) )
		{
			Log.Info( "joined lobby!" );
		}
    }
}
